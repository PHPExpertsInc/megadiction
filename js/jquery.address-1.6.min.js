(function(b){b.address=function(){var s=function(a){a=b.extend(b.Event(a),function(){for(var a={},d=b.address.parameterNames(),e=0,f=d.length;e<f;e++)a[d[e]]=b.address.parameter(d[e]);return{value:b.address.value(),path:b.address.path(),pathNames:b.address.pathNames(),parameterNames:d,parameters:a,queryString:b.address.queryString()}}.call(b.address));b(b.address).trigger(a);return a},h=function(a){return Array.prototype.slice.call(a)},g=function(a,c,d){b().bind.apply(b(b.address),Array.prototype.slice.call(arguments));
return b.address},Z=function(a,c){b().unbind.apply(b(b.address),Array.prototype.slice.call(arguments));return b.address},F=function(){return z.pushState&&d.state!==m},P=function(){return("/"+n.pathname.replace(RegExp(d.state),"")+n.search+(G()?"#"+G():"")).replace(O,"/")},G=function(){var a=n.href.indexOf("#");return-1!=a?n.href.substr(a+1):""},q=function(){return F()?P():G()},L=function(a){a=a.toString();return(d.strict&&"/"!=a.substr(0,1)?"/":"")+a},t=function(a,c){return parseInt(a.css(c),10)},
B=function(){if(!H){var a=q();decodeURI(e)!=decodeURI(a)&&(v&&7>w?n.reload():(v&&(!I&&d.history)&&u(M,50),e=a,A(p)))}},A=function(a){u($,10);return s(Q).isDefaultPrevented()||s(a?R:S).isDefaultPrevented()},$=function(){if("null"!==d.tracker&&d.tracker!==C){var a=b.isFunction(d.tracker)?d.tracker:f[d.tracker],c=(n.pathname+n.search+(b.address&&!F()?b.address.value():"")).replace(/\/\//,"/").replace(/^\/$/,"");b.isFunction(a)?a(c):b.isFunction(f.urchinTracker)?f.urchinTracker(c):f.pageTracker!==m&&
b.isFunction(f.pageTracker._trackPageview)?f.pageTracker._trackPageview(c):f._gaq!==m&&b.isFunction(f._gaq.push)&&f._gaq.push(["_trackPageview",decodeURI(c)])}},M=function(){var a="javascript:"+p+";document.open();document.writeln('<html><head><title>"+l.title.replace(/\'/g,"\\'")+"</title><script>var "+x+' = "'+encodeURIComponent(q()).replace(/\'/g,"\\'")+(l.domain!=n.hostname?'";document.domain="'+l.domain:"")+"\";\x3c/script></head></html>');document.close();";7>w?k.src=a:k.contentWindow.location.replace(a)},
U=function(){if(D&&-1!=T){var a,c,b=D.substr(T+1).split("&");for(a=0;a<b.length;a++)c=b[a].split("="),/^(autoUpdate|history|strict|wrap)$/.test(c[0])&&(d[c[0]]=isNaN(c[1])?/^(true|yes)$/i.test(c[1]):0!==parseInt(c[1],10)),/^(state|tracker)$/.test(c[0])&&(d[c[0]]=c[1]);D=C}e=q()},W=function(){if(!V){V=r;U();b('a[rel*="address:"]').address();if(d.wrap){var a=b("body");b("body > *").wrapAll('<div style="padding:'+(t(a,"marginTop")+t(a,"paddingTop"))+"px "+(t(a,"marginRight")+t(a,"paddingRight"))+"px "+
(t(a,"marginBottom")+t(a,"paddingBottom"))+"px "+(t(a,"marginLeft")+t(a,"paddingLeft"))+'px;" />').parent().wrap('<div id="'+x+'" style="height:100%;overflow:auto;position:relative;'+(J&&!window.statusbar.visible?"resize:both;":"")+'" />');b("html, body").css({height:"100%",margin:0,padding:0,overflow:"hidden"});J&&b('<style type="text/css" />').appendTo("head").text("#"+x+"::-webkit-resizer { background-color: #fff; }")}v&&!I&&(a=l.getElementsByTagName("frameset")[0],k=l.createElement((a?"":"i")+
"frame"),k.src="javascript:"+p,a?(a.insertAdjacentElement("beforeEnd",k),a[a.cols?"cols":"rows"]+=",0",k.noResize=r,k.frameBorder=k.frameSpacing=0):(k.style.display="none",k.style.width=k.style.height=0,k.tabIndex=-1,l.body.insertAdjacentElement("afterBegin",k)),u(function(){b(k).bind("load",function(){var a=k.contentWindow;e=a[x]!==m?a[x]:"";e!=q()&&(A(p),n.hash=e)});k.contentWindow[x]===m&&M()},50));u(function(){s("init");A(p)},1);F()||(v&&7<w||!v&&I?f.addEventListener?f.addEventListener(E,B,p):
f.attachEvent&&f.attachEvent("on"+E,B):aa(B,50));"state"in window.history&&b(window).trigger("popstate")}},m,C=null,x="jQueryAddress",E="hashchange",Q="change",R="internalChange",S="externalChange",r=!0,p=!1,d={autoUpdate:r,history:r,strict:r,wrap:p},y=function(){var a,c,b={};a=navigator.userAgent;a=a.toLowerCase();c=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||
[];a=c[1]||"";c=c[2]||"0";a&&(b[a]=!0,b.version=c);b.chrome?b.webkit=!0:b.webkit&&(b.safari=!0);return b}(),w=parseFloat(y.version),J=y.webkit||y.safari,v=!b.support.opacity,f;try{f=top.document!==m&&top.document.title!==m?top:window}catch(ca){f=window}var l=f.document,z=f.history,n=f.location,aa=setInterval,u=setTimeout,O=/\/{2,9}/g,y=navigator.userAgent,I="on"+E in f,k,D=b("script:last").attr("src"),T=D?D.indexOf("?"):-1,N=l.title,H=p,V=p,X=r,K=p,e=q();if(v){w=parseFloat(y.substr(y.indexOf("MSIE")+
4));l.documentMode&&l.documentMode!=w&&(w=8!=l.documentMode?7:8);var Y=l.onpropertychange;l.onpropertychange=function(){Y&&Y.call(l);l.title!=N&&-1!=l.title.indexOf("#"+q())&&(l.title=N)}}z.navigationMode&&(z.navigationMode="compatible");if("complete"==document.readyState)var ba=setInterval(function(){b.address&&(W(),clearInterval(ba))},50);else U(),b(W);b(window).bind("popstate",function(){decodeURI(e)!=decodeURI(q())&&(e=q(),A(p))}).bind("unload",function(){f.removeEventListener?f.removeEventListener(E,
B,p):f.detachEvent&&f.detachEvent("on"+E,B)});return{bind:function(a,c,b){return g.apply(this,h(arguments))},unbind:function(a,c){return Z.apply(this,h(arguments))},init:function(a,c){return g.apply(this,["init"].concat(h(arguments)))},change:function(a,c){return g.apply(this,[Q].concat(h(arguments)))},internalChange:function(a,c){return g.apply(this,[R].concat(h(arguments)))},externalChange:function(a,c){return g.apply(this,[S].concat(h(arguments)))},baseURL:function(){var a=n.href;-1!=a.indexOf("#")&&
(a=a.substr(0,a.indexOf("#")));/\/$/.test(a)&&(a=a.substr(0,a.length-1));return a},autoUpdate:function(a){return a!==m?(d.autoUpdate=a,this):d.autoUpdate},history:function(a){return a!==m?(d.history=a,this):d.history},state:function(a){if(a!==m){d.state=a;var c=P();d.state!==m&&(z.pushState?"/#/"==c.substr(0,3)&&n.replace(d.state.replace(/^\/$/,"")+c.substr(2)):"/"!=c&&c.replace(/^\/#/,"")!=G()&&u(function(){n.replace(d.state.replace(/^\/$/,"")+"/#"+c)},1));return this}return d.state},strict:function(a){return a!==
m?(d.strict=a,this):d.strict},tracker:function(a){return a!==m?(d.tracker=a,this):d.tracker},wrap:function(a){return a!==m?(d.wrap=a,this):d.wrap},update:function(){K=r;this.value(e);K=p;return this},title:function(a){return a!==m?(u(function(){N=l.title=a;X&&(k&&k.contentWindow&&k.contentWindow.document)&&(k.contentWindow.document.title=a,X=p)},50),this):l.title},value:function(a){if(a!==m){a=L(a);"/"==a&&(a="");if(e==a&&!K)return;e=a;if(d.autoUpdate||K){if(A(r))return this;if(F())z[d.history?"pushState":
"replaceState"]({},"",d.state.replace(/\/$/,"")+(""===e?"/":e));else H=r,J?d.history?n.hash="#"+e:n.replace("#"+e):e!=q()&&(d.history?n.hash="#"+e:n.replace("#"+e)),v&&!I&&d.history&&u(M,50),J?u(function(){H=p},1):H=p}return this}return L(e)},path:function(a){if(a!==m){var c=this.queryString(),b=this.hash();this.value(a+(c?"?"+c:"")+(b?"#"+b:""));return this}return L(e).split("#")[0].split("?")[0]},pathNames:function(){var a=this.path(),b=a.replace(O,"/").split("/");("/"==a.substr(0,1)||0===a.length)&&
b.splice(0,1);"/"==a.substr(a.length-1,1)&&b.splice(b.length-1,1);return b},queryString:function(a){if(a!==m){var b=this.hash();this.value(this.path()+(a?"?"+a:"")+(b?"#"+b:""));return this}a=e.split("?");return a.slice(1,a.length).join("?").split("#")[0]},parameter:function(a,c,d){var e,f;if(c!==m){var h=this.parameterNames();f=[];c=c===m||c===C?"":c.toString();for(e=0;e<h.length;e++){var k=h[e],g=this.parameter(k);"string"==typeof g&&(g=[g]);k==a&&(g=c===C||""===c?[]:d?g.concat([c]):[c]);for(var l=
0;l<g.length;l++)f.push(k+"="+g[l])}-1==b.inArray(a,h)&&(c!==C&&""!==c)&&f.push(a+"="+c);this.queryString(f.join("&"));return this}if(c=this.queryString()){d=[];f=c.split("&");for(e=0;e<f.length;e++)c=f[e].split("="),c[0]==a&&d.push(c.slice(1).join("="));if(0!==d.length)return 1!=d.length?d:d[0]}},parameterNames:function(){var a=this.queryString(),c=[];if(a&&-1!=a.indexOf("="))for(var a=a.split("&"),d=0;d<a.length;d++){var e=a[d].split("=")[0];-1==b.inArray(e,c)&&c.push(e)}return c},hash:function(a){if(a!==
m)return this.value(e.split("#")[0]+(a?"#"+a:"")),this;a=e.split("#");return a.slice(1,a.length).join("#")}}}();b.fn.address=function(s){this.data("address")||this.on("click",function(h){if(h.shiftKey||h.ctrlKey||h.metaKey||2==h.which)return!0;var g=h.currentTarget;b(g).is("a")&&(h.preventDefault(),h=s?s.call(g):/address:/.test(b(g).attr("rel"))?b(g).attr("rel").split("address:")[1].split(" ")[0]:void 0!==b.address.state()&&!/^\/?$/.test(b.address.state())?b(g).attr("href").replace(RegExp("^(.*"+
b.address.state()+"|\\.)"),""):b(g).attr("href").replace(/^(#\!?|\.)/,""),b.address.value(h))}).on("submit",function(h){var g=h.currentTarget;b(g).is("form")&&(h.preventDefault(),h=b(g).attr("action"),g=s?s.call(g):(-1!=h.indexOf("?")?h.replace(/&$/,""):h+"?")+b(g).serialize(),b.address.value(g))}).data("address",!0);return this}})(jQuery);
